@page
@model Subchron.Web.Pages.Employee.LeaveModel
@{
    ViewData["Title"] = "Leave Requests";
    ViewData["PageTitle"] = "Leave Requests";
    Layout = "/Pages/Employee/Shared/_LayoutEmployee.cshtml";
}

<div class="mx-auto max-w-5xl">
    <div class="mb-6 flex gap-2 border-b border-slate-200 dark:border-slate-700">
        <button type="button" id="tabNewLeave" class="emp-tab border-b-2 border-subgreen-600 pb-2 text-sm font-semibold text-subgreen-600 dark:border-subgreen-400 dark:text-subgreen-400">New Request</button>
        <button type="button" id="tabMyLeaves" class="emp-tab border-b-2 border-transparent pb-2 text-sm font-semibold text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300">My Leave Requests</button>
    </div>

    <div id="panelNewLeave" class="space-y-6">
        <p class="text-sm text-slate-500 dark:text-slate-400">Submit a leave request for manager approval.</p>
        <form id="leaveForm" class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-700 dark:bg-slate-800">
            <div class="grid gap-4 sm:grid-cols-2">
                <div class="sm:col-span-2">
                    <label for="leaveType" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Leave type</label>
                    <select id="leaveType" required class="mt-1.5 w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-slate-900 focus:border-subgreen-500 focus:ring-2 focus:ring-subgreen-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                        <option value="">Select type</option>
                        <option value="Vacation">Vacation</option>
                        <option value="Sick">Sick leave</option>
                        <option value="Personal">Personal</option>
                        <option value="Bereavement">Bereavement</option>
                        <option value="Parental">Parental</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="leaveStart" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Start date</label>
                    <input type="date" id="leaveStart" required class="mt-1.5 w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-slate-900 focus:border-subgreen-500 focus:ring-2 focus:ring-subgreen-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100" />
                </div>
                <div>
                    <label for="leaveEnd" class="block text-sm font-medium text-slate-700 dark:text-slate-300">End date</label>
                    <input type="date" id="leaveEnd" required class="mt-1.5 w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-slate-900 focus:border-subgreen-500 focus:ring-2 focus:ring-subgreen-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100" />
                </div>
                <div class="sm:col-span-2">
                    <label for="leaveReason" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Reason / notes</label>
                    <textarea id="leaveReason" rows="3" placeholder="Optional details" class="mt-1.5 w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-slate-900 placeholder-slate-400 focus:border-subgreen-500 focus:ring-2 focus:ring-subgreen-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 dark:placeholder-slate-500"></textarea>
                </div>
            </div>
            <p id="leaveValidationMsg" class="mt-2 hidden text-sm text-red-600 dark:text-red-400"></p>
            <button type="submit" class="mt-4 w-full rounded-xl bg-subgreen-600 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-subgreen-500 dark:bg-subgreen-500 dark:hover:bg-subgreen-400">Submit Request</button>
        </form>
    </div>

    <div id="panelMyLeaves" class="hidden space-y-4">
        <p class="text-sm text-slate-500 dark:text-slate-400">View and track your leave requests.</p>
        <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800">
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead>
                        <tr class="border-y border-slate-100 bg-slate-50/50 dark:border-slate-700 dark:bg-slate-800/50">
                            <th class="px-5 py-3 font-semibold uppercase tracking-wider text-slate-600 dark:text-slate-300">Type</th>
                            <th class="px-5 py-3 font-semibold uppercase tracking-wider text-slate-600 dark:text-slate-300">Start</th>
                            <th class="px-5 py-3 font-semibold uppercase tracking-wider text-slate-600 dark:text-slate-300">End</th>
                            <th class="px-5 py-3 font-semibold uppercase tracking-wider text-slate-600 dark:text-slate-300">Days</th>
                            <th class="px-5 py-3 font-semibold uppercase tracking-wider text-slate-600 dark:text-slate-300">Notes</th>
                            <th class="px-5 py-3 font-semibold uppercase tracking-wider text-slate-600 dark:text-slate-300">Submitted</th>
                            <th class="px-5 py-3 font-semibold uppercase tracking-wider text-slate-600 dark:text-slate-300">Status</th>
                        </tr>
                    </thead>
                    <tbody id="leaveTableBody" class="divide-y divide-slate-100 dark:divide-slate-700">
                        <tr>
                            <td class="px-5 py-3 font-medium text-slate-700 dark:text-slate-300">Vacation</td>
                            <td class="px-5 py-3 text-slate-600 dark:text-slate-400">Mar 10, 2025</td>
                            <td class="px-5 py-3 text-slate-600 dark:text-slate-400">Mar 14, 2025</td>
                            <td class="px-5 py-3 tabular-nums text-slate-600 dark:text-slate-400">5</td>
                            <td class="max-w-[160px] truncate px-5 py-3 text-slate-500 dark:text-slate-400">Family trip</td>
                            <td class="px-5 py-3 text-slate-500 dark:text-slate-400">Feb 18, 2025</td>
                            <td class="px-5 py-3">
                                <span class="inline-flex items-center rounded-full bg-amber-50 px-2.5 py-0.5 text-xs font-medium text-amber-700 dark:bg-amber-900/30 dark:text-amber-300">Pending</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="px-5 py-3 font-medium text-slate-700 dark:text-slate-300">Sick leave</td>
                            <td class="px-5 py-3 text-slate-600 dark:text-slate-400">Feb 12, 2025</td>
                            <td class="px-5 py-3 text-slate-600 dark:text-slate-400">Feb 12, 2025</td>
                            <td class="px-5 py-3 tabular-nums text-slate-600 dark:text-slate-400">1</td>
                            <td class="max-w-[160px] truncate px-5 py-3 text-slate-500 dark:text-slate-400">—</td>
                            <td class="px-5 py-3 text-slate-500 dark:text-slate-400">Feb 11, 2025</td>
                            <td class="px-5 py-3">
                                <span class="inline-flex items-center rounded-full bg-subgreen-50 px-2.5 py-0.5 text-xs font-medium text-subgreen-700 dark:bg-subgreen-900/30 dark:text-subgreen-300">Approved</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="px-5 py-3 font-medium text-slate-700 dark:text-slate-300">Personal</td>
                            <td class="px-5 py-3 text-slate-600 dark:text-slate-400">Feb 5, 2025</td>
                            <td class="px-5 py-3 text-slate-600 dark:text-slate-400">Feb 6, 2025</td>
                            <td class="px-5 py-3 tabular-nums text-slate-600 dark:text-slate-400">2</td>
                            <td class="max-w-[160px] truncate px-5 py-3 text-slate-500 dark:text-slate-400">—</td>
                            <td class="px-5 py-3 text-slate-500 dark:text-slate-400">Feb 1, 2025</td>
                            <td class="px-5 py-3">
                                <span class="inline-flex items-center rounded-full bg-red-50 px-2.5 py-0.5 text-xs font-medium text-red-700 dark:bg-red-900/30 dark:text-red-300">Rejected</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="leaveTableEmpty" class="hidden px-5 py-8 text-center text-sm text-slate-500 dark:text-slate-400">No leave requests yet. Submit one from the New Request tab.</div>
        </div>
    </div>
</div>

@section Scripts {
<script>
(function () {
    var tabNew = document.getElementById('tabNewLeave');
    var tabMy = document.getElementById('tabMyLeaves');
    var panelNew = document.getElementById('panelNewLeave');
    var panelMy = document.getElementById('panelMyLeaves');
    var form = document.getElementById('leaveForm');
    var leaveType = document.getElementById('leaveType');
    var leaveStart = document.getElementById('leaveStart');
    var leaveEnd = document.getElementById('leaveEnd');
    var leaveReason = document.getElementById('leaveReason');
    var validationMsg = document.getElementById('leaveValidationMsg');

    function setActiveTab(active) {
        var isNew = active === 'new';
        panelNew.classList.toggle('hidden', !isNew);
        panelMy.classList.toggle('hidden', isNew);
        tabNew.classList.toggle('border-subgreen-600', isNew);
        tabNew.classList.toggle('text-subgreen-600', isNew);
        tabNew.classList.toggle('dark:border-subgreen-400', isNew);
        tabNew.classList.toggle('dark:text-subgreen-400', isNew);
        tabNew.classList.toggle('border-transparent', !isNew);
        tabMy.classList.toggle('border-subgreen-600', !isNew);
        tabMy.classList.toggle('text-subgreen-600', !isNew);
        tabMy.classList.toggle('dark:border-subgreen-400', !isNew);
        tabMy.classList.toggle('dark:text-subgreen-400', !isNew);
        tabMy.classList.toggle('border-transparent', isNew);
    }

    function showValidation(msg) {
        if (!validationMsg) return;
        validationMsg.textContent = msg || '';
        validationMsg.classList.toggle('hidden', !msg);
    }

    tabNew && tabNew.addEventListener('click', function () { setActiveTab('new'); });
    tabMy && tabMy.addEventListener('click', function () { setActiveTab('my'); });

    form && form.addEventListener('submit', function (e) {
        e.preventDefault();
        showValidation('');
        var typeVal = leaveType && leaveType.value;
        var startVal = leaveStart && leaveStart.value;
        var endVal = leaveEnd && leaveEnd.value;
        if (!typeVal || !startVal || !endVal) {
            showValidation('Please select leave type and enter start and end dates.');
            return;
        }
        var start = new Date(startVal);
        var end = new Date(endVal);
        if (end < start) {
            showValidation('End date must be on or after start date.');
            return;
        }
        var today = new Date();
        today.setHours(0, 0, 0, 0);
        if (start < today) {
            showValidation('Start date cannot be in the past.');
            return;
        }
        showValidation('');
        setActiveTab('my');
        form.reset();
    });
})();
</script>
}
