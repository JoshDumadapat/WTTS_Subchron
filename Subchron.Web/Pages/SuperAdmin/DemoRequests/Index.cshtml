@page
@model Subchron.Web.Pages.SuperAdmin.DemoRequests.IndexModel
@{
    ViewData["Title"] = "Demo Requests";
  ViewData["PageTitle"] = "Demo Requests";
    ViewData["PageDescription"] = "Manage demo requests and approvals";
    ViewData["ShowSearch"] = true;
    Layout = "~/Pages/SuperAdmin/Shared/_LayoutSuperAdmin.cshtml";
}

<div class="bg-white rounded-2xl shadow-md border border-slate-200 p-6 dark:bg-slate-800 dark:border-slate-700">
    <!-- Header and filters -->
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
        <div>
   <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Demo Request Management</h2>
      <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">@Model.DemoRequests.Count total requests</p>
</div>
        <div class="flex items-center space-x-4 mt-4 lg:mt-0">
 <!-- View toggle -->
 <div class="flex bg-slate-100 rounded-lg p-1 dark:bg-slate-700">
     <button id="listViewBtn" class="px-3 py-1 text-sm font-medium rounded-md transition-colors @(Model.ViewMode == "list" ? "bg-white text-slate-900 shadow-sm dark:bg-slate-600 dark:text-white" : "text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300")">
   <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
          </svg>
     List View
     </button>
       <button id="calendarViewBtn" class="px-3 py-1 text-sm font-medium rounded-md transition-colors @(Model.ViewMode == "calendar" ? "bg-white text-slate-900 shadow-sm dark:bg-slate-600 dark:text-white" : "text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300")">
<svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m0 0V5a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V7a2 2 0 012-2h4z" />
            </svg>
   Calendar View
        </button>
    </div>
     
<!-- Status filter -->
       <div class="relative">
    <select id="statusFilter" class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-subblue-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
           <option value="">All Statuses</option>
        <option value="Pending">Pending</option>
      <option value="Approved">Approved</option>
         <option value="Rejected">Rejected</option>
           </select>
  </div>
</div>
    </div>

  <!-- List View -->
    <div id="listView" class="@(Model.ViewMode == "calendar" ? "hidden" : "")">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
    <thead>
   <tr>
  <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
     Organization
           </th>
  <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
      Contact
              </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
        Details
    </th>
  <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
      Status
            </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
  Created
  </th>
   <th class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
  Actions
</th>
    </tr>
      </thead>
        <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
        @foreach (var request in Model.DemoRequests)
           {
       <tr class="hover:bg-slate-50 dark:hover:bg-slate-750">
     <td class="px-6 py-4 whitespace-nowrap">
           <div class="flex items-center">
     <div class="h-10 w-10 flex-shrink-0">
  <div class="h-10 w-10 rounded-full bg-subblue-100 dark:bg-subblue-900/50 flex items-center justify-center">
         <svg class="h-5 w-5 text-subblue-600 dark:text-subblue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m0 0V5a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V7a2 2 0 012-2h4z" />
  </svg>
        </div>
      </div>
       <div class="ml-4">
        <div class="text-sm font-medium text-slate-900 dark:text-white">@request.OrgName</div>
    <div class="text-sm text-slate-500 dark:text-slate-400">Size: @request.OrgSize</div>
     </div>
         </div>
                </td>
   <td class="px-6 py-4 whitespace-nowrap">
   <div class="text-sm text-slate-900 dark:text-white">@request.ContactName</div>
       <div class="text-sm text-slate-500 dark:text-slate-400">@request.Email</div>
   <div class="text-sm text-slate-500 dark:text-slate-400">@request.Phone</div>
     </td>
         <td class="px-6 py-4">
        <div class="text-sm text-slate-900 dark:text-white">Mode: @request.DesiredMode</div>
   <div class="text-sm text-slate-500 dark:text-slate-400 max-w-xs truncate">@request.Message</div>
        </td>
    <td class="px-6 py-4 whitespace-nowrap">
         <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
          @(request.Status switch {
         "Pending" => "bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300",
          "Approved" => "bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300",
       "Rejected" => "bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",
        _ => "bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"
            })">
          @request.Status
      </span>
              </td>
      <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400">
              @request.CreatedAt.ToString("MMM dd, yyyy")
       </td>
             <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
     <a asp-page="/SuperAdmin/DemoRequests/Details" asp-route-id="@request.DemoRequestID"
  class="text-subblue-600 hover:text-subblue-900 dark:text-subblue-400 dark:hover:text-subblue-300">
 View
       </a>
     </td>
       </tr>
    }
        </tbody>
   </table>
      </div>

    @if (!Model.DemoRequests.Any())
        {
    <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m0 0V5a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V7a2 2 0 012-2h4z" />
</svg>
         <h3 class="mt-2 text-sm font-medium text-slate-900 dark:text-white">No demo requests</h3>
    <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Demo requests will appear here when submitted.</p>
            </div>
        }
    </div>

    <!-- Calendar View -->
    <div id="calendarView" class="@(Model.ViewMode == "list" ? "hidden" : "")">
        <div class="mb-4 flex items-center justify-between">
            <h3 class="text-lg font-medium text-slate-900 dark:text-white">@Model.CurrentMonth.ToString("MMMM yyyy")</h3>
      <div class="flex space-x-2">
              <button id="prevMonth" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                  <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
         </svg>
          </button>
     <button id="nextMonth" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
<svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
  </svg>
      </button>
       </div>
        </div>

        <!-- Calendar Grid -->
  <div class="grid grid-cols-7 gap-px bg-slate-200 rounded-lg overflow-hidden dark:bg-slate-600">
     <!-- Day headers -->
  @foreach (var day in new[] { "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" })
     {
      <div class="bg-slate-50 p-2 text-center text-xs font-medium text-slate-500 uppercase dark:bg-slate-700 dark:text-slate-400">
   @day
    </div>
}

            <!-- Calendar days -->
    @for (int i = 0; i < Model.CalendarDays.Count; i++)
    {
    var day = Model.CalendarDays[i];
           <div class="bg-white dark:bg-slate-800 min-h-[100px] p-2 @(day.IsCurrentMonth ? "" : "opacity-50")">
            <div class="text-sm font-medium text-slate-900 dark:text-white mb-2">@day.Day</div>
   <div class="space-y-1">
       @foreach (var request in day.Requests)
             {
    <div class="p-1 rounded text-xs font-medium cursor-pointer hover:opacity-80
        @(request.Status switch {
        "Pending" => "bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300",
          "Approved" => "bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300",
         "Rejected" => "bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",
        _ => "bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"
          })"
  onclick="window.location.href='/SuperAdmin/DemoRequests/Details?id=@request.DemoRequestID'">
                @request.OrgName.Substring(0, Math.Min(request.OrgName.Length, 10))@(request.OrgName.Length > 10 ? "..." : "")
     </div>
     }
    </div>
                </div>
          }
        </div>
    </div>
</div>

<script>
    // View toggle functionality
    document.getElementById('listViewBtn')?.addEventListener('click', function() {
      document.getElementById('listView').classList.remove('hidden');
        document.getElementById('calendarView').classList.add('hidden');
        this.classList.add('bg-white', 'text-slate-900', 'shadow-sm', 'dark:bg-slate-600', 'dark:text-white');
        this.classList.remove('text-slate-500', 'hover:text-slate-700', 'dark:text-slate-400', 'dark:hover:text-slate-300');
        document.getElementById('calendarViewBtn').classList.remove('bg-white', 'text-slate-900', 'shadow-sm', 'dark:bg-slate-600', 'dark:text-white');
        document.getElementById('calendarViewBtn').classList.add('text-slate-500', 'hover:text-slate-700', 'dark:text-slate-400', 'dark:hover:text-slate-300');
    });

    document.getElementById('calendarViewBtn')?.addEventListener('click', function() {
        document.getElementById('calendarView').classList.remove('hidden');
        document.getElementById('listView').classList.add('hidden');
        this.classList.add('bg-white', 'text-slate-900', 'shadow-sm', 'dark:bg-slate-600', 'dark:text-white');
        this.classList.remove('text-slate-500', 'hover:text-slate-700', 'dark:text-slate-400', 'dark:hover:text-slate-300');
    document.getElementById('listViewBtn').classList.remove('bg-white', 'text-slate-900', 'shadow-sm', 'dark:bg-slate-600', 'dark:text-white');
        document.getElementById('listViewBtn').classList.add('text-slate-500', 'hover:text-slate-700', 'dark:text-slate-400', 'dark:hover:text-slate-300');
  });

    // Search functionality for list view
 document.getElementById('globalSearch')?.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#listView tbody tr');
        
        rows.forEach(row => {
   const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });

    // Status filter
    document.getElementById('statusFilter')?.addEventListener('change', function(e) {
        const status = e.target.value;
        const rows = document.querySelectorAll('#listView tbody tr');
        
rows.forEach(row => {
            if (!status) {
                row.style.display = '';
       return;
       }
            
  const statusCell = row.querySelector('td:nth-child(4) span');
 const rowStatus = statusCell?.textContent.trim();
        row.style.display = rowStatus === status ? '' : 'none';
        });
    });
</script>