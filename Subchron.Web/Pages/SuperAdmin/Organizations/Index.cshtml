@page
@model Subchron.Web.Pages.SuperAdmin.Organizations.IndexModel
@{
    ViewData["Title"] = "Organizations";
    ViewData["PageTitle"] = "Organizations";
    ViewData["PageDescription"] = "Manage organization accounts and settings";
    ViewData["ShowSearch"] = true;
    Layout = "~/Pages/SuperAdmin/Shared/_LayoutSuperAdmin.cshtml";
}

<div class="bg-white rounded-2xl shadow-md border border-slate-200 p-6 dark:bg-slate-800 dark:border-slate-700">
    <!-- Header and filters -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
        <div>
            <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Organization Management</h2>
       <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">@Model.Organizations.Count total organizations</p>
        </div>
        <div class="flex items-center space-x-4 mt-4 sm:mt-0">
    <div class="relative">
  <select id="statusFilter" class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-subgreen-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
       <option value="">All Statuses</option>
   <option value="Trial">Trial</option>
          <option value="Active">Active</option>
            <option value="Suspended">Suspended</option>
           <option value="Expired">Expired</option>
        </select>
       </div>
 <a asp-page="/SuperAdmin/Organizations/Create" 
             class="inline-flex items-center px-4 py-2 bg-subgreen-600 text-white text-sm font-medium rounded-lg hover:bg-subgreen-700 focus:outline-none focus:ring-2 focus:ring-subgreen-500 focus:ring-offset-2">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
   </svg>
         New Organization
            </a>
    </div>
 </div>

    <!-- Organizations table -->
    <div class="overflow-x-auto">
     <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
      <thead>
         <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
          Organization
        </th>
             <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
          Code
 </th>
     <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
  Status
      </th>
<th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
   Subscription
   </th>
  <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
         Created
        </th>
<th class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider dark:text-slate-400">
      Actions
          </th>
      </tr>
            </thead>
            <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
          @foreach (var org in Model.Organizations)
   {
<tr class="hover:bg-slate-50 dark:hover:bg-slate-750">
        <td class="px-6 py-4 whitespace-nowrap">
           <div class="flex items-center">
     <div class="h-10 w-10 flex-shrink-0">
        <div class="h-10 w-10 rounded-full bg-subgreen-100 dark:bg-subgreen-900/50 flex items-center justify-center">
<svg class="h-5 w-5 text-subgreen-600 dark:text-subgreen-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
   </svg>
       </div>
              </div>
         <div class="ml-4">
                 <div class="text-sm font-medium text-slate-900 dark:text-white">@org.OrgName</div>
          <div class="text-sm text-slate-500 dark:text-slate-400">ID: @org.OrgID</div>
           </div>
           </div>
     </td>
  <td class="px-6 py-4 whitespace-nowrap">
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-200">
 @org.OrgCode
             </span>
   </td>
    <td class="px-6 py-4 whitespace-nowrap">
             <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
          @(org.Status switch {
           "Trial" => "bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300",
   "Active" => "bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300",
       "Suspended" => "bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",
   "Expired" => "bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300",
        _ => "bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"
       })">
               @org.Status
   </span>
  </td>
 <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-white">
   @org.SubscriptionStatus
    </td>
       <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400">
@org.CreatedAt.ToString("MMM dd, yyyy")
 </td>
        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
       <div class="flex items-center justify-end space-x-2">
     <a asp-page="/SuperAdmin/Organizations/Details" asp-route-id="@org.OrgID"
      class="text-subgreen-600 hover:text-subgreen-900 dark:text-subgreen-400 dark:hover:text-subgreen-300">
         View
   </a>
           <a asp-page="/SuperAdmin/Organizations/Edit" asp-route-id="@org.OrgID"
          class="text-subblue-600 hover:text-subblue-900 dark:text-subblue-400 dark:hover:text-subblue-300">
           Edit
                </a>
         <a asp-page="/SuperAdmin/Subscriptions/Manage" asp-route-orgId="@org.OrgID"
class="text-purple-600 hover:text-purple-900 dark:text-purple-400 dark:hover:text-purple-300">
        Subscription
       </a>
      @if (org.Status != "Suspended")
    {
      <button onclick="suspendOrg(@org.OrgID, '@org.OrgName')"
        class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">
          Suspend
     </button>
        }
   </div>
        </td>
       </tr>
   }
            </tbody>
        </table>
    </div>

    @if (!Model.Organizations.Any())
    {
        <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
     </svg>
   <h3 class="mt-2 text-sm font-medium text-slate-900 dark:text-white">No organizations</h3>
         <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Get started by creating a new organization.</p>
   <div class="mt-6">
                <a asp-page="/SuperAdmin/Organizations/Create"
     class="inline-flex items-center px-4 py-2 bg-subgreen-600 text-white text-sm font-medium rounded-lg hover:bg-subgreen-700">
       <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
      </svg>
     New Organization
           </a>
  </div>
        </div>
    }

    <!-- Pagination -->
    @if (Model.Organizations.Any())
    {
<div class="flex items-center justify-between border-t border-slate-200 dark:border-slate-700 px-4 py-3 sm:px-6">
            <!-- Mobile Pagination -->
          <div class="flex flex-1 justify-between sm:hidden">
   <a href="#" class="relative inline-flex items-center rounded-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-600">Previous</a>
      <a href="#" class="relative ml-3 inline-flex items-center rounded-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-600">Next</a>
            </div>

    <!-- Desktop Pagination -->
       <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
    <div class="flex items-center gap-4">
               <!-- Rows per page selector -->
         <div class="flex items-center gap-2">
         <label for="rowsPerPage" class="text-sm text-slate-700 dark:text-slate-300">Rows per page:</label>
  <select id="rowsPerPage" class="rounded-md border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-3 py-1.5 text-sm text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-subgreen-500">
         <option value="5">5</option>
  <option value="10" selected>10</option>
              <option value="20">20</option>
             <option value="40">40</option>
         </select>
   </div>

             <!-- Results info -->
       <div>
     <p class="text-sm text-slate-700 dark:text-slate-300">
            Showing
         <span class="font-medium">1</span>
    to
      <span class="font-medium">10</span>
of
       <span class="font-medium">@Model.Organizations.Count</span>
     results
        </p>
     </div>
  </div>

    <!-- Page numbers -->
       <div>
         <nav aria-label="Pagination" class="isolate inline-flex -space-x-px rounded-md shadow-sm">
            <!-- Previous button -->
       <a href="#" class="relative inline-flex items-center rounded-l-md px-2 py-2 text-slate-400 ring-1 ring-inset ring-slate-300 dark:ring-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 focus:z-20 focus:outline-offset-0">
         <span class="sr-only">Previous</span>
 <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="h-5 w-5">
        <path fill-rule="evenodd" d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
      </a>

          <!-- Page 1 (active) -->
          <a href="#" aria-current="page" class="relative z-10 inline-flex items-center bg-subgreen-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-subgreen-600">1</a>

     <!-- Page 2 -->
             <a href="#" class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-slate-900 dark:text-slate-200 ring-1 ring-inset ring-slate-300 dark:ring-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 focus:z-20 focus:outline-offset-0">2</a>

      <!-- Page 3 -->
  <a href="#" class="relative hidden items-center px-4 py-2 text-sm font-semibold text-slate-900 dark:text-slate-200 ring-1 ring-inset ring-slate-300 dark:ring-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 focus:z-20 focus:outline-offset-0 md:inline-flex">3</a>

       <!-- Ellipsis -->
               <span class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-slate-400 ring-1 ring-inset ring-slate-300 dark:ring-slate-600 focus:outline-offset-0">...</span>

      <!-- Page 8 -->
          <a href="#" class="relative hidden items-center px-4 py-2 text-sm font-semibold text-slate-900 dark:text-slate-200 ring-1 ring-inset ring-slate-300 dark:ring-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 focus:z-20 focus:outline-offset-0 md:inline-flex">8</a>

          <!-- Page 9 -->
   <a href="#" class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-slate-900 dark:text-slate-200 ring-1 ring-inset ring-slate-300 dark:ring-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 focus:z-20 focus:outline-offset-0">9</a>

   <!-- Page 10 -->
            <a href="#" class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-slate-900 dark:text-slate-200 ring-1 ring-inset ring-slate-300 dark:ring-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 focus:z-20 focus:outline-offset-0">10</a>

      <!-- Next button -->
         <a href="#" class="relative inline-flex items-center rounded-r-md px-2 py-2 text-slate-400 ring-1 ring-inset ring-slate-300 dark:ring-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 focus:z-20 focus:outline-offset-0">
      <span class="sr-only">Next</span>
     <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="h-5 w-5">
     <path fill-rule="evenodd" d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
           </svg>
        </a>
       </nav>
         </div>
            </div>
        </div>
    }
</div>

<script>
    // Pagination state
    let currentPage = 1;
    let rowsPerPage = 10;
    let allRows = [];

    function initializePagination() {
        allRows = Array.from(document.querySelectorAll('tbody tr'));
        updatePagination();
    }

    function updatePagination() {
  const totalRows = allRows.length;
      const totalPages = Math.ceil(totalRows / rowsPerPage);
        const start = (currentPage - 1) * rowsPerPage;
     const end = start + rowsPerPage;

// Show/hide rows
        allRows.forEach((row, index) => {
    if (index >= start && index < end) {
    row.style.display = '';
   } else {
  row.style.display = 'none';
   }
  });

        // Update pagination info
   document.querySelector('.text-sm.text-slate-700 span:nth-of-type(1)').textContent = start + 1;
        document.querySelector('.text-sm.text-slate-700 span:nth-of-type(2)').textContent = Math.min(end, totalRows);
     document.querySelector('.text-sm.text-slate-700 span:nth-of-type(3)').textContent = totalRows;
    }

    // Rows per page change
    document.getElementById('rowsPerPage')?.addEventListener('change', function(e) {
        rowsPerPage = parseInt(e.target.value);
        currentPage = 1;
        updatePagination();
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        initializePagination();
    });

    function suspendOrg(orgId, orgName) {
    if (confirm(`Are you sure you want to suspend "${orgName}"?`)) {
         // TODO: Implement suspend organization
   fetch(`/SuperAdmin/Organizations/Suspend`, {
       method: 'POST',
      headers: {
    'Content-Type': 'application/json',
        },
    body: JSON.stringify({ orgId: orgId })
    }).then(response => {
if (response.ok) {
               location.reload();
}
            });
        }
    }

    // Search functionality
    document.getElementById('globalSearch')?.addEventListener('input', function(e) {
   const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
   const text = row.textContent.toLowerCase();
      row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
  });

  // Status filter
 document.getElementById('statusFilter')?.addEventListener('change', function(e) {
 const status = e.target.value;
      const rows = document.querySelectorAll('tbody tr');
  
      rows.forEach(row => {
       if (!status) {
      row.style.display = '';
 return;
          }
       
  const statusCell = row.querySelector('td:nth-child(3) span');
   const rowStatus = statusCell?.textContent.trim();
    row.style.display = rowStatus === status ? '' : 'none';
    });
    });
</script>